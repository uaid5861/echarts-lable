import{d as I,c as i,e as r,f as a,F as M,C as D,u as x,n as S,g as h,p as j,m as V,_ as $,r as v,w as T,B as w,h as U,v as B,i as L,E as H,j as A,A as F}from"./index-13e6781a.js";const K=_=>(j("data-v-8f04358d"),_=_(),V(),_),N={class:"messagecontainer"},W=K(()=>a("div",{class:"search"},[a("input",{type:"text",placeholder:"search"})],-1)),E={class:"contact-list"},O=["onClick"],R=["src"],z={class:"namemassage"},P={class:"name"},q={class:"message"},G=I({__name:"ContactList",props:{contacts:{},activeContactId:{}},emits:["selectContact"],setup(_,{emit:f}){const m=_,{contacts:o,activeContactId:d}=m,c=f;function p(u){c("selectContact",u)}return(u,y)=>(i(),r("div",N,[W,a("div",E,[a("ul",null,[(i(!0),r(M,null,D(x(o),l=>(i(),r("li",{key:l.id,onClick:()=>p(l),class:S({active:l.id===x(d)})},[a("img",{src:l.avatar,alt:""},null,8,R),a("div",z,[a("p",P,h(l.name),1),a("p",q,h(l.latestMessage||"暂无新消息"),1)]),a("span",null,h(l.latestMessageTime||""),1)],10,O))),128))])])]))}});const J=$(G,[["__scopeId","data-v-8f04358d"]]),Q={class:"chat-window"},X={key:0,style:{"line-height":"1.8","font-weight":"500"}},Y=["src"],Z={class:"putbar"},ee={key:0,class:"image-preview"},te=["src"],se=I({__name:"ChatWindow",props:{contact:{},messages:{}},emits:["sendMessage"],setup(_,{emit:f}){const m=_,o=f,d=v(""),c=v(""),p=v(null);function u(){if(d.value.trim()||c.value){const t={id:Date.now(),contactId:m.contact.id,text:d.value.trim()||void 0,imageUrl:c.value||void 0,time:new Date().toISOString(),sender:"me"};o("sendMessage",t),d.value="",c.value="",C()}}function y(t){var e;const s=(e=t.target.files)==null?void 0:e[0];if(s){const g=new FileReader;g.onload=b=>{var k;c.value=(k=b.target)==null?void 0:k.result},g.readAsDataURL(s)}}function l(){c.value=""}T(()=>m.messages,async()=>{await H(),C()});function C(){p.value&&(p.value.scrollTop=p.value.scrollHeight)}T(()=>m.contact,()=>{d.value="",c.value=""});function n(t){const s=new Date,e=new Date(t),g=s.getTime()-e.getTime(),b=24*60*60*1e3;return g<b&&s.getDate()===e.getDate()?e.toTimeString().slice(0,5):g<b*2&&s.getDate()-e.getDate()===1?"昨天 "+e.toTimeString().slice(0,5):e.toISOString().slice(0,10)+" "+e.toTimeString().slice(0,5)}return(t,s)=>(i(),r("div",Q,[a("h2",null,"与 "+h(t.contact.name)+" 的聊天",1),a("div",{class:"messages",ref_key:"messagesContainer",ref:p},[(i(!0),r(M,null,D(t.messages,e=>(i(),r("div",{key:e.id,class:S(["message",e.sender==="me"?"sent":"received"])},[e.text?(i(),r("p",X,h(e.text),1)):w("",!0),e.imageUrl?(i(),r("img",{key:1,src:e.imageUrl,alt:"Image",style:{"max-width":"100%","border-radius":"10px"}},null,8,Y)):w("",!0),a("small",null,h(n(e.time)),1)],2))),128))],512),a("div",Z,[c.value?(i(),r("div",ee,[a("img",{src:c.value,alt:"Image Preview"},null,8,te),a("button",{onClick:l,class:"remove-btn"},"x")])):w("",!0),c.value?w("",!0):(i(),r("input",{key:1,type:"file",onChange:y,class:"imgboxbtn"},null,32)),U(a("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>d.value=e),onKeyup:L(u,["enter"]),placeholder:"输入消息并按回车发送",class:"sendmessage"},null,544),[[B,d.value]]),a("button",{onClick:u,class:"sendbtn"},"发送")])]))}});const ae=$(se,[["__scopeId","data-v-3eb4bb93"]]),ne={class:"chat-app"},oe=I({__name:"Message",setup(_){const f=v([{id:1,name:"房产中介",avatar:"https://picture.gptkong.com/20240712/2341b23645147443968cb1af7422d9eff3.jpg"},{id:2,name:"浴皇大帝",avatar:"https://picture.gptkong.com/20240712/23424e3fbf75a7425fa8fe2264387b08b9.jpeg"},{id:3,name:"素颜女大",avatar:"https://picture.gptkong.com/20240712/2342ebfba3ba974fac8101e47351e75cc6.jpg"},{id:4,name:"全妆女大",avatar:"https://picture.gptkong.com/20240712/23435444fd02974cd5b74c904dddf75180.jpg"}]),m=v([{id:1,contactId:1,text:"Hello Alice!",time:"2024/6/17 10:20",sender:"me"},{id:2,contactId:2,text:"Hi Bob!",time:"2024/6/17 11:30",sender:"other"},{id:3,contactId:3,text:"Hey Charlie!",time:"2024/6/17 12:40",sender:"other"}]),o=v(null);function d(n){o.value=n}function c(n){return m.value.filter(t=>t.contactId===n).sort((t,s)=>new Date(t.time).getTime()-new Date(s.time).getTime())}function p(n){m.value.push(n),C(n.contactId,n.text||"图片消息",n.time)}const u=v("");function y(n,t){const s=new Date().toLocaleString(),e={id:Date.now(),contactId:n,text:t,time:s,sender:"other"};m.value.push(e),C(n,t,s)}const l=()=>{o.value&&(y(o.value.id,u.value),u.value="")};function C(n,t,s){const e=f.value.find(g=>g.id===n);e&&(e.latestMessage=t,e.latestMessageTime=s)}return(n,t)=>(i(),r("div",ne,[A(J,{contacts:f.value,onSelectContact:d,activeContactId:o.value?o.value.id:null},null,8,["contacts","activeContactId"]),o.value?(i(),F(ae,{key:0,contact:o.value,messages:c(o.value.id),onSendMessage:p},null,8,["contact","messages"])):w("",!0),U(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=s=>u.value=s),onKeyup:L(l,["enter"]),class:"test",placeholder:"在此测试输入对方消息"},null,544),[[B,u.value]])]))}});export{oe as default};
